DIRS=raw jbig tiff zlib
LIBS=zlib/libz.a CxImage/cximage.a jbig/jbig.a tiff/tiff.a raw/raw.a
ARCH=@ARCH@
LIB=../../../system/ImageLib-$(ARCH).so

$(LIB): ${LIBS}
	gcc -shared -o $(LIB) -Wl,--whole-archive -lpng -ljasper -ljpeg \
		${LIBS} -Wl,--no-whole-archive \
		`cat ../../cores/DllLoader/exports/wrapper.def` \
		../../cores/DllLoader/exports/wrapper.o

${LIBS}: compile 

compile:
	$(MAKE) -C CxImage -fMakefile.linux
	$(MAKE) -C jbig
	$(MAKE) -C raw
	$(MAKE) -C tiff
	$(MAKE) -C zlib

clean:
	-for d in $(DIRS); do (cd $$d; $(MAKE) clean ); done
	$(MAKE) -C CxImage -fMakefile.linux clean
	rm -f $(LIB)

distclean:
	-for d in $(DIRS); do (cd $$d; $(MAKE) distclean ); done
	$(MAKE) -C CxImage -fMakefile.linux distclean
	rm -f $(LIB)

.PHONY: compile clean distclean
