include ../../../../Makefile.include

OBJS = MADCodec/MadMp3Decoder.o
CFLAGS += -D_LINUX -fPIC -O3

LIB=../../../../system/players/paplayer/MADCodec-@ARCH@.so

lib: $(LIB)

$(LIB): $(OBJS)
ifeq ($(ARCH), osx)
	ld -bundle -flat_namespace -undefined suppress -o $@ \
		MADCodec/MadMp3Decoder.o \
		../../dvdplayer/Codecs/libmad/.libs/libmad.a
	../../../../tools/Mach5/wrapper.rb $@;mv output.so $@
	chmod +x $@

else
ifneq (@USE_EXTERNAL_LIBMAD@,1)
	gcc -shared -o $@  MADCodec/MadMp3Decoder.o ../../dvdplayer/Codecs/libmad/.libs/libmad.a `cat ../../DllLoader/exports/wrapper.def` ../../DllLoader/exports/wrapper.o -fPIC -O3
else
	gcc -shared -o $@  MADCodec/MadMp3Decoder.o -lmad `cat ../../DllLoader/exports/wrapper.def` ../../DllLoader/exports/wrapper.o -fPIC -O3
endif
endif
