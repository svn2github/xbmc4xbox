From e22155ef0eb393dfc8f6e2a6d9d47d95a8aea9c3 Mon Sep 17 00:00:00 2001
From: Joakim Plate <elupus@ecce.se>
Date: Wed, 14 Sep 2011 19:26:57 +0200
Subject: [PATCH 24/34] [nsv] Check return value of avio_seek and avoid
 modifying state if it fails

---
 libavformat/nsvdec.c |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/libavformat/nsvdec.c b/libavformat/nsvdec.c
index bf03cec..b3bb31f 100644
--- a/libavformat/nsvdec.c
+++ b/libavformat/nsvdec.c
@@ -703,7 +703,9 @@ static int nsv_read_seek(AVFormatContext *s, int stream_index, int64_t timestamp
     if(index < 0)
         return -1;
 
-    avio_seek(s->pb, st->index_entries[index].pos, SEEK_SET);
+    if (avio_seek(s->pb, st->index_entries[index].pos, SEEK_SET) < 0)
+        return -1;
+
     nst->frame_offset = st->index_entries[index].timestamp;
     nsv->state = NSV_UNSYNC;
     return 0;
-- 
1.7.5.4

