From 1df00ac80f86119ffb03f01c757145b6942d071e Mon Sep 17 00:00:00 2001
From: Joakim Plate <elupus@ecce.se>
Date: Wed, 14 Sep 2011 19:24:25 +0200
Subject: [PATCH 18/34] [dv] Check return value of avio_seek and avoid
 modifying state if it fails

---
 libavformat/dv.c |    7 ++++---
 1 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/libavformat/dv.c b/libavformat/dv.c
index becea54..f495e1e 100644
--- a/libavformat/dv.c
+++ b/libavformat/dv.c
@@ -475,10 +475,11 @@ static int dv_read_seek(AVFormatContext *s, int stream_index,
     DVDemuxContext *c = r->dv_demux;
     int64_t offset    = dv_frame_offset(s, c, timestamp, flags);
 
-    dv_offset_reset(c, offset / c->sys->frame_size);
+    if (avio_seek(s->pb, offset, SEEK_SET) < 0)
+        return -1;
 
-    offset = avio_seek(s->pb, offset, SEEK_SET);
-    return (offset < 0) ? offset : 0;
+    dv_offset_reset(c, offset / c->sys->frame_size);
+    return 0;
 }
 
 static int dv_read_close(AVFormatContext *s)
-- 
1.7.5.4

