From 58540d7bd3561593d48f76db9096ede118a0a6b1 Mon Sep 17 00:00:00 2001
From: Joakim Plate <elupus@ecce.se>
Date: Wed, 14 Sep 2011 19:25:18 +0200
Subject: [PATCH 20/34] [filmstrip] Check return value of avio_seek and avoid
 modifying state if it fails

---
 libavformat/filmstripdec.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/libavformat/filmstripdec.c b/libavformat/filmstripdec.c
index 3963b53..a99dcba 100644
--- a/libavformat/filmstripdec.c
+++ b/libavformat/filmstripdec.c
@@ -94,7 +94,8 @@ static int read_packet(AVFormatContext *s,
 static int read_seek(AVFormatContext *s, int stream_index, int64_t timestamp, int flags)
 {
     AVStream *st = s->streams[stream_index];
-    avio_seek(s->pb, FFMAX(timestamp, 0) * st->codec->width * st->codec->height * 4, SEEK_SET);
+    if (avio_seek(s->pb, FFMAX(timestamp, 0) * st->codec->width * st->codec->height * 4, SEEK_SET) < 0)
+        return -1;
     return 0;
 }
 
-- 
1.7.5.4

