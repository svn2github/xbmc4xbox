From a10bd5edd13e8aff5e81bd1c8dddebde1698ed36 Mon Sep 17 00:00:00 2001
From: Cory Fields <theuni-nospam-@xbmc.org>
Date: Fri, 9 Jul 2010 15:22:09 -0400
Subject: [PATCH 20/36] fixed: wrong fps for rmvb files (patch by taxigps)

---
 libavformat/rmdec.c |    7 +++----
 1 files changed, 3 insertions(+), 4 deletions(-)

Index: ffmpeg/libavformat/rmdec.c
===================================================================
--- ffmpeg.orig/libavformat/rmdec.c	2011-05-27 18:18:44.000000000 +0100
+++ ffmpeg/libavformat/rmdec.c	2011-05-27 18:21:06.202928099 +0100
@@ -294,18 +294,17 @@
             goto fail1;
         st->codec->width = avio_rb16(pb);
         st->codec->height = avio_rb16(pb);
-        st->codec->time_base.num= 1;
+        st->codec->time_base.num= 1 << 16;
         fps= avio_rb16(pb);
         st->codec->codec_type = AVMEDIA_TYPE_VIDEO;
         avio_rb32(pb);
-        fps2= avio_rb16(pb);
-        avio_rb16(pb);
+        fps2= avio_rb32(pb);
 
         if ((ret = rm_read_extradata(pb, st->codec, codec_data_size - (avio_tell(pb) - codec_pos))) < 0)
             return ret;
 
 //        av_log(s, AV_LOG_DEBUG, "fps= %d fps2= %d\n", fps, fps2);
-        st->codec->time_base.den = fps * st->codec->time_base.num;
+        st->codec->time_base.den = fps2;
         //XXX: do we really need that?
         switch(st->codec->extradata[4]>>4){
         case 1: st->codec->codec_id = CODEC_ID_RV10; break;
