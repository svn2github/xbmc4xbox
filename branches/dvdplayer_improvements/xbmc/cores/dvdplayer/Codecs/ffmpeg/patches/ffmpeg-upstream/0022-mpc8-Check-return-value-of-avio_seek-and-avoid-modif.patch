From 88ad79415c3821e5c4f3cb4d5b289d772fcac621 Mon Sep 17 00:00:00 2001
From: Joakim Plate <elupus@ecce.se>
Date: Wed, 14 Sep 2011 19:26:32 +0200
Subject: [PATCH 22/34] [mpc8] Check return value of avio_seek and avoid
 modifying state if it fails

---
 libavformat/mpc8.c |    3 ++-
 1 files changed, 2 insertions(+), 1 deletions(-)

diff --git a/libavformat/mpc8.c b/libavformat/mpc8.c
index 7a4cbbc..5b43884 100644
--- a/libavformat/mpc8.c
+++ b/libavformat/mpc8.c
@@ -274,7 +274,8 @@ static int mpc8_read_seek(AVFormatContext *s, int stream_index, int64_t timestam
     int index = av_index_search_timestamp(st, timestamp, flags);
 
     if(index < 0) return -1;
-    avio_seek(s->pb, st->index_entries[index].pos, SEEK_SET);
+    if (avio_seek(s->pb, st->index_entries[index].pos, SEEK_SET) < 0)
+        return -1;
     c->frame = st->index_entries[index].timestamp;
     return 0;
 }
-- 
1.7.5.4

