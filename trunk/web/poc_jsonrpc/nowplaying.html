<html>
<head>
<title>XBMC - Now playing</title>
<link type="text/css" rel="stylesheet" href="basic.css">
<script type="text/javascript" src="json.js"> // FOR browsers which doesn't have it included
</script>
<script type="text/javascript">
function CallMethod(method)
{
  var http_request = new XMLHttpRequest();
  http_request.open( "POST", "jsonrpc", false );
  http_request.send("{\"jsonrpc\": \"2.0\", \"method\": \"" + method + "\", \"params\": { \"fields\": [\"title\", \"plot\"] }, \"id\": 1}");
  window.location.reload( false );
}

function refresh()
{
  window.location.reload( false );
}
</script>

</head>
<body>
<h1>Now playing   <a href="movies.html">Movies</a>   <a href="tvshows.html">TV Shows</a>   <a href="albums.html">Albums</a></h1>

<script type="text/javascript">
setTimeout( "refresh()", 5*1000 );
var http_request = new XMLHttpRequest();
http_request.open( "POST", "jsonrpc", false );
http_request.send("{\"jsonrpc\": \"2.0\", \"method\": \"Playlist.GetItems\", \"params\": { \"fields\": [\"title\", \"plot\"] }, \"id\": 1}");

var the_object = JSON.parse(http_request.responseText);
var result = the_object["result"];
var activeItem = result["current"];
var array = result["items"];

if (activeItem >= 0) {
 if (array[activeItem]["thumbnail"])
   document.write("<img src=\"thumb/" + array[activeItem]["thumbnail"] + ".jpg\"></img>");
  else
    document.write("<img src=\"images/DefaultAlbumCover.png\"></img>");

  document.write("<br></br>");

  document.write("<img src=\"images/OSDPrevTrackFO.png\" onclick=CallMethod(\"Player.SkipPrevious\")></img>");
  document.write("<img src=\"images/OSDStopFO.png\" onclick=CallMethod(\"Player.Stop\")></img>");
  document.write("<img src=\"images/OSDPlayFO.png\" onclick=CallMethod(\"Player.PlayPause\")></img>");
  document.write("<img src=\"images/OSDNextTrackFO.png\" onclick=CallMethod(\"Player.SkipNext\")></img>");

  document.write("<br></br>");

  document.write("<table class=\"Playlist\"><tbody>");
  var odd = false;
  var i = 0;
  for (var property in array) {
    var item = array[property];
    var row = "even";
    if (odd)
      row = "odd";

    document.write("<tr class=\"" + row + "\">");
    document.write("<td class=\"label\">" + item["label"] + "</td>");
    if (i == activeItem)
      document.write("<td class=\"playing\"><img src=\"images/play.png\" height=16></img></td>");
    else
      document.write("<td class=\"playing\"></td>");
    document.write("</tr>");

    odd = !odd;
    i++;
  }
  document.write("</tbody></table>");
} else {
  document.write("Nothings playing");
}
</script>
</body>
</html>
